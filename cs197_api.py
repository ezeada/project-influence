# Makes a POST request to the API, return a json file under GeneratedData, can be modified later with pandas library
# where the completions are suitable to place in a DataFrame. 
#
#   TODO 1: Generate a randomize prompt generator from the database created by @carolyn
#   TODO 2: Implement a database to hold the data generated by this API
#   TODO 3: Automate the requests by running it along the background
#
import requests
import pandas as pd
import json

res = requests.post("https://api.ai21.com/studio/v1/j1-jumbo/complete", 
headers={"Authorization" : "Bearer ZPtVIXs3vcoKAd85YI5OSRlqJOtSfIpU"},
json={
    "prompt" : "Input: Alex \n Name: Alex \n Country: USA \n Input: Jawi \n Name: Jawi \n Country: USA \n Input: Arman \n Name: Arman \n Country: ",
    "numResults" : 1,
    "maxTokens" : 5,
    # Higher temperature means greater sampling
    # temperature = 0 means, output the value with the highest probability
    "temperature" : 0
})



data = res.json()
completions = data["completions"][0]
id = data["id"]

with open('GeneratedData/data.json', 'w') as f:
    json.dump(data, f, ensure_ascii=False)

with open('GeneratedData/completions.json', 'w') as f:
    json.dump(completions, f, ensure_ascii=False)

print(id)
print(completions["data"]["text"])


## CODE ON DOCUMENTATION
# >>> res = requests.post("...", json={"prompt": "This is the 1st line\nThis is the 2nd line", 
#                                      "temperature": 0, "maxTokens": 16})
# >>> res.status_code
# 200
# >>> data = res.json()
# >>> data['completions'][0]['data']['text']
# '\nThis is the 3rd line\nThis is the 4th line\nThis is the 5th line\n'
# >>> tokens = [t['generatedToken']['token'] for t in data['completions'][0]['data']['tokens']]
# >>> "".join(tokens)
# '<|newline|>▁This▁is▁the▁3rd▁line<|newline|>▁This▁is▁the▁4th▁line<|newline|>▁This▁is▁the▁5th▁line<|newline|>'
# >>> "".join(tokens).replace("▁"," ").replace("<|newline|>", "\n")
# '\n This is the 3rd line\n This is the 4th line\n This is the 5th line\n'
